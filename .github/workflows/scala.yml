name: Scala CI

on:
  push:
    branches: [ main ]
    paths:
      - "applications/**"
      - "libs/**"
      - "plugins/**"
      - "build.sbt"
  pull_request:
    branches: [ main ]
    paths:
      - "applications/**"
      - "libs/**"
      - "plugins/**"
      - "build.sbt"

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      # define Java options for both official sbt and sbt-extras
      JAVA_OPTS: -Xms2048M -Xmx2048M -Xss6M -XX:ReservedCodeCacheSize=256M -Dfile.encoding=UTF-8
      JVM_OPTS: -Xms2048M -Xmx2048M -Xss6M -XX:ReservedCodeCacheSize=256M -Dfile.encoding=UTF-8
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    steps:
      - name: "Checkout repository"
        uses: actions/checkout@v2
      - name: "Setup JDK 13"
        uses: actions/setup-java@v2
        with:
          distribution: temurin
          java-version: 17.0.2+8
      - name: "Coursier cache"
        uses: coursier/cache-action@v6
      - name: "Build & Run tests"
        run: sbt -v test
      - name: "Scalafmt"
        run: sbt scalafmtAll
      - name: "Verify Changed files"
        uses: tj-actions/verify-changed-files@v8.8
        id: verify-changed-files
        with:
          files: |
            .(sbt|scala)$
      - uses: EndBug/add-and-commit@v8
        with:
          # The name of the user that will be displayed as the author of the commit.
          # Default: depends on the default_author input
          author_name: scalafmt

          # The email of the user that will be displayed as the author of the commit.
          # Default: depends on the default_author input
          author_email: balyszyn@gmail.com

          # The name of the custom committer you want to use, if different from the author of the commit.
          # Default: the name of the author (set with either author_name or default_author)
          committer_name: scalafmt

          # The email of the custom committer you want to use, if different from the author of the commit.
          # Default: the email of the author (set with either author_email or default_author)
          committer_email: balyszyn@gmail.com


          # Determines the way the action fills missing author name and email. Three options are available:
          # - github_actor -> UserName <UserName@users.noreply.github.com>
          # - user_info -> Your Display Name <your-actual@email.com>
          # - github_actions -> github-actions <email associated with the github logo>
          # Default: github_actor
          default_author: github_actor

          # The message for the commit.
          # Default: 'Commit from GitHub Actions (name of the workflow)'
          message: 'Your commit message'

          push: origin "${{github.base_ref}}" "${{github.head_ref}}"
